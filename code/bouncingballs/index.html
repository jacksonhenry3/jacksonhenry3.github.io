<html>
	<head>
		<link href='http://fonts.googleapis.com/css?family=Iceberg' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Roboto+Slab:300' rel='stylesheet' type='text/css'>
		<link href="../../styles/sub_style.css" rel="stylesheet" type="text/css" />
         <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?1.25.0">
    </script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <title> Jackson's resume</title>
	</head>
    <style type = 'text/css'>
    #back
    {
        font-family: 'Iceberg', cursive;
    }
    h1,h2,h3,#header,a
    {
        font-family: 'Iceberg', cursive;
    }

    #header
    {
        background-image: url('../../textures/use_your_illusion/use_your_illusion.png');
    }

    </style>
	<body>
        
		<div id = 'header'>
			Bouncing Balls
		</div>
        <div id = 'back'><a href = "../">&#8592</a></div>
		<div id = 'content'>
			<div style = 'max-width:1000px;margin:0px auto;'>
               
                    <h1> The balls! let them bounce!</h1>
                    <div id = 'program'></div>

                    <h2> view and/or edit the program</h2>
                    <a href = 'http://codepen.io/jacksonhenry3/pen/jHomB' class = 'button' style = 'background-color:green'>Codepen</a>

                    <h2> about </h2>
                    <p>
                        This Program was written in javascript using d3 and jquery. I Consider it to be me first realy javascript simulation. It's not very complex nor very effecient but I hope to add collision detection innefecient bouncing and air resistance in the near future.
                    </p>
        <script>

            var 
            width        =    $("#program").width()      // of svg, in pixels
            height       =     500//$("#content").height()      //of svg, in pixels
            data         =     []       //this will contain all of the bouncing balls
            t_step       =     .08   // the time that will have progressed after each itteration in seconds
            radius       =     10        //radius of the balls, in pixels
            opacity      =     1        //opacity of the balls, to see when they overlap % from 0-1
            //on_click   =     true     //add the ability to easily change between click and fountain modes
            x_velocity   =     10       //the velocity in the x direction
            y_velocity   =     0        //the initial velocity in the y direction
            acceleration =     10   // the acceleration
            delay        =     1;       // in ms

            //add the svg to the page
            var svg = d3.select("#program").append("svg:svg")
                        //set the attributes (width height and background color)
                        .attr(     "width"           ,  width)
                        .attr(     "height"          ,  height)
                        .style(    "background-color",  '#CCC')
                        //begin the animation when the page loads
                        .on(       "load"            ,  init)
                        //add more balls when the mouse is moved on the svg
                        .on(       "mousemove"       ,  add_data)

                        //function to switch between click and mousemove (NOT WORKING)
                        /*.on(
                            function()
                            {
                                if (on_click)
                                {
                                    return "click"
                                }
                                if (! on_click)
                                {
                                    return "mousemove"
                                }
                            },
                            add_data)*/

            //adds values to data
            function add_data(){
                //get the mouse position
                var m = d3.svg.mouse(this)
                //set the x and y coordinates of the ball to those of the mouse
                x = m[0],
                y = m[1],

                //add the coodinates (and velocities) to data
                data.push(
                    {   
                        "x" :x,
                        "y" :y,
                        "x_velocity":Math.floor(Math.random()*100)-50,
                        "y_velocity":Math.floor(Math.random()*100)-50
                    }
                )

                //render the data on the svg
                draw(data)
            }

            //displays all the balls in data
            function draw(data){
                //select all svg circles
                svg.selectAll("circle")
                   .data(data)
                   .enter()
                   //adds a new circle for the new entry in data
                   .append("circle")
                   //set the circle attributes to the chosen values
                   .attr("cx",function(d){return d["x"]})
                   .attr("cy",function(d){return d["y"]})
                   .attr("r",radius)
                   .style("fill-opacity",opacity)
                   //color the circle based on the position it was created
                   .style("fill", function(d) 
                        {
                            return "rgb("+
                                //red value
                                Math.round(Math.floor(d["x"]*d["y"])/(width*height)*255)+
                                ","+
                                //green value
                                Math.round(Math.floor((d["x"]/width)*255))+
                                ","+
                                //blue value
                                Math.round(Math.floor((d["y"]/height)*255))+
                                ")";
                        }
                    ); 
                }

            //the main portion of the animation
            function doAnim()
                {      
                    //select all the circles on the svg
                    svg.selectAll("circle")
                        //set the new y coordinate of the ball
                        .attr("cy",
                            function(d){
                                //get the current y and y velocity
                                var y           = d["y"];
                                var y_velocity  = d["y_velocity"];
                                //calculate the new y and y vvelcoities
                                d["y"]          = y+y_velocity*t_step
                                d["y_velocity"] = y_velocity+acceleration*t_step

                                //if the ball is below the edge AND going down reversy the balls y direction
                                if (y+radius>height && y_velocity>0){
                                    d["y_velocity"] = -.92*y_velocity         
                                }
                                //give cy the y of the ball
                                return d["y"]
                            }
                        )
                        //set the new x coordinate of the ball
                        .attr("cx",
                            function(d){
                                //get the current x and x valocity
                                var x           = d["x"];
                                var x_velocity  = d["x_velocity"];
                                //calculate new x and x velocity
                                d["x"]          = x+x_velocity*t_step
                                d["x_velocity"] = x_velocity

                                if (y+radius>height){
                                    d["x_velocity"] = -.5*x_velocity         
                                }


                                //if the ball hit's either the left or right wall reverse its velocity and cheange its position to inside the svg
                                if (x+radius>width)
                                {
                                    d["x_velocity"] = -.1*x_velocity   
                                    d["x"] = width-radius       
                                    
                                }
                                else if (x+radius<0)
                                {
                                    d["x_velocity"] = -.1*x_velocity
                                    d["x"] = radius
                                }

                                //give cx the x position of the ball
                                return d["x"]
                            }
                        )
                }

            //run the next step in the animation after delay milliseconds
            function init()
                {
                    timer = setInterval(doAnim, delay); 
                }  
        </script>
                    
		
	</div>
	</body>
</html>
